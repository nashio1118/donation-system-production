# Googleスプレッドシート セットアップ手順

## 1. スプレッドシートの作成

### 1.1 新しいスプレッドシートを作成
1. [Google Sheets](https://sheets.google.com) にアクセス
2. 「新規作成」→「スプレッドシート」を選択
3. スプレッドシートの名前を「寄付者管理システム」に変更

### 1.2 シートの作成
以下の6つのシートを作成してください：

#### シート1: 返礼品設定
| 列A | 列B | 列C | 列D | 列E |
|-----|-----|-----|-----|-----|
| 返礼品ID | 返礼品名 | 最小金額 | 説明 | 有効/無効 |
| towel | タオル | 10000 | 高級タオル | TRUE |
| sweets_large | お菓子大 | 10000 | 高級お菓子セット | TRUE |
| keychain | キーホルダー | 5000 | オリジナルキーホルダー | TRUE |
| sweets_small | お菓子小 | 5000 | お菓子セット | TRUE |
| clearfile | クリアファイル | 1000 | オリジナルクリアファイル | TRUE |

#### シート2: 寄付金金額設定
| 列A | 列B | 列C | 列D |
|-----|-----|-----|-----|
| 金額ID | 金額 | 表示名 | 有効/無効 |
| amount_10000 | 10000 | ¥10,000 | TRUE |
| amount_5000 | 5000 | ¥5,000 | TRUE |

#### シート3: 負担金金額設定
| 列A | 列B | 列C | 列D | 列E |
|-----|-----|-----|-----|-----|
| 設定項目ID | 設定項目名 | 金額 | 説明 | 有効/無効 |
| burden_fee | 負担金 | 40000 | 1人分の負担金 | TRUE |
| encouragement_fee | 奨励会負担金 | 1000 | 奨励会負担金 | TRUE |

#### シート4: 寄付金一覧
| 列A | 列B | 列C | 列D | 列E | 列F | 列G | 列H |
|-----|-----|-----|-----|-----|-----|-----|-----|
| 氏名 | 備考 | 寄付金 | 負担金 | Tシャツ代 | 奨励会負担金 | 振込合計金額 | 寄付・負担金計 |

#### シート5: 返礼品一覧
| 列A | 列B | 列C | 列D | 列E | 列F | 列G | 列H |
|-----|-----|-----|-----|-----|-----|-----|-----|
| No. | 学年 | 生徒氏名 | タオル | お菓子大 | キーホルダー | お菓子小 | クリアファイル |

#### シート6: 1ページ目データ整理
| 列A | 列B | 列C | 列D | 列E | 列F | 列G | 列H | 列I | 列J | 列K | 列L | 列M | 列N | 列O | 列P | 列Q | 列R | 列S | 列T | 列U | 列V | 列W |
|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| 送信日時 | 氏名 | 学年 | 振込日 | 振込金額 | 直接振込金額 | 寄付金 | 負担金 | Tシャツ代 | 奨励会負担金 | その他の費用 | 兄弟1の学年 | 兄弟1の名前 | 兄弟2の学年 | 兄弟2の名前 | 兄弟3の学年 | 兄弟3の名前 | 兄弟4の学年 | 兄弟4の名前 | 兄弟5の学年 | 兄弟5の名前 | 兄弟の人数 | 備考 |

#### シート7: 2ページ目データ整理
| 列A | 列B | 列C | 列D | 列E | 列F | 列G |
|-----|-----|-----|-----|-----|-----|-----|
| 送信日時 | 1ページ目氏名 | 寄付者名 | 寄付金額 | 返礼品 | クリアファイル枚数 | 備考 |

## 2. Google Apps Scriptの設定

### 2.1 Google Apps Scriptプロジェクトの作成
1. スプレッドシートを開いた状態で「拡張機能」→「Apps Script」を選択
2. プロジェクト名を「寄付者管理システム」に変更

### 2.2 スクリプトの設定
1. `Code.gs`ファイルの内容を削除
2. `google-apps-script-config.gs`の内容をコピー&ペースト

### 2.3 デプロイの設定
1. 「デプロイ」→「新しいデプロイ」を選択
2. 「種類の選択」→「ウェブアプリ」を選択
3. 以下の設定を行う：
   - 説明：「寄付者管理システム v1.0」
   - 次のユーザーとして実行：「自分」
   - アクセスできるユーザー：「全員」
4. 「デプロイ」をクリック

### 2.4 CORS問題の解決（重要）
1. デプロイ完了後、「デプロイ」→「管理」をクリック
2. 最新のデプロイを選択して「編集」をクリック
3. 「アクセスできるユーザー」が「全員」になっていることを確認
4. 「更新」をクリック
5. 新しいウェブアプリURLをコピー

### 2.5 ウェブアプリURLの取得
1. デプロイ完了後、ウェブアプリURLが表示されます
2. このURLをコピーして保存してください

## 3. Webアプリケーションの設定

### 3.1 JavaScriptファイルの更新
`js/sheets.js`ファイルの以下の行を更新：

```javascript
this.scriptUrl = 'YOUR_GOOGLE_APPS_SCRIPT_URL'; // デプロイしたURLに変更
```

### 3.2 権限の設定
1. 初回アクセス時に権限の承認が必要です
2. 「詳細」→「安全でないページに移動」をクリック
3. Googleアカウントでログイン
4. 必要な権限を承認

## 4. 動作確認

### 4.1 設定の読み込み確認
1. Webアプリケーションを開く
2. ブラウザの開発者ツール（F12）を開く
3. コンソールでエラーがないことを確認

### 4.2 フォーム送信テスト
1. テストデータを入力
2. フォームを送信
3. スプレッドシートにデータが追加されることを確認

## 5. トラブルシューティング

### 5.1 よくある問題

#### 権限エラー
- Google Apps Scriptの権限を再確認
- ウェブアプリの設定で「全員」にアクセス権限を設定

#### CORSエラー
- ブラウザのキャッシュをクリア
- 開発者ツールでネットワークタブを確認

#### データが送信されない
- JavaScriptコンソールでエラーメッセージを確認
- Google Apps Scriptのログを確認

### 5.2 ログの確認方法
1. Google Apps Scriptエディタで「実行」→「実行ログ」を選択
2. エラーメッセージを確認

## 6. 設定のカスタマイズ

### 6.1 返礼品の追加・変更
1. 「返礼品設定」シートを編集
2. 新しい行を追加または既存行を編集
3. 変更後、Webアプリケーションを再読み込み

### 6.2 金額設定の変更
1. 「寄付金金額設定」または「負担金金額設定」シートを編集
2. 金額や表示名を変更
3. 変更後、Webアプリケーションを再読み込み

## 7. セキュリティ考慮事項

### 7.1 アクセス制御
- スプレッドシートの共有設定を適切に管理
- 必要に応じて特定のユーザーのみにアクセス権限を制限

### 7.2 データバックアップ
- 定期的にスプレッドシートのバックアップを作成
- 重要なデータは別途保存

## 8. 運用上の注意点

### 8.1 データ管理
- 定期的にデータの整合性を確認
- 重複データや不正データのチェック

### 8.2 パフォーマンス
- 大量のデータがある場合は、定期的に古いデータをアーカイブ
- スプレッドシートのサイズが大きくなりすぎないよう注意 